# 聊天室

## 功能

- 发送消息
- 接收消息
- 显示历史消息
- 显示消息是否已读
- 显示消息发送者
- 显示消息发送时间

## 流程

- 进入聊天室
    - 获取聊天室基本信息
        - 不存在：创建聊天室
    - 更新聊天室中记录的个人信息（是否在线，最近一次上线时间）
    - 返回当前聊天室ID和未读消息
    - 返回聊天室用户是否在线
        - 在线：在线聊天，并记录
        - 不在线：提示用户不在线，允许留言

- 创建聊天室
    - 获取聊天室人员信息
    - 初始化聊天室
        - 生成UUID作为聊天室ID
        - 初始化聊天室人员信息（用户ID）

- 获取当前聊天室未读消息
    - 获取当前聊天室未读消息
    - 更新对方消息为已读状态

- 在线聊天
    - 接收聊天信息和聊天室信息，发送给接收者
    - 记录聊天信息到聊天记录表
    - 允许用户下线

- 离线留言
    - 接收聊天信息和聊天室信息
    - 直接记录聊天信息到聊天记录表，并标记为未读（离线留言）
    - 允许用户下线

- 用户下线
    - 更新聊天室中记录的个人信息（是否在线，最近一次下线时间）

## 前置条件

- 获取当前用户全部未读消息
    - 获取当前用户所有未读消息
    - **不更新消息状态**

## 接口简述

- 内部接口

  - 聊天室基本信息
    - 初始化聊天室（创建聊天室）
    - 获取聊天室基本信息
    - 更新用户上线信息
    - 更新用户下线信息

  - 聊天记录信息
    - 新增在线聊天的记录
    - 新增离线聊天（留言）的信息记录
    - 查询某用户全部未读信息记录
    - 查询某聊天室全部未读信息记录
    - 修改某条记录为已读
    

- 外部接口

  - 查找聊天室
  - 进入聊天室（WS）